{"version":3,"file":"wsrpc.js","sources":["wsrpc.es6.js"],"sourcesContent":["class Deferred {\n\tconstructor() {\n\t\tconst self = this;\n\n\t\tself.resolve = null;\n\t\tself.reject = null;\n\t\tself.done = false;\n\n\t\tfunction wrapper(func) {\n\t\t\treturn function () {\n\t\t\t\tif (self.done) {\n\t\t\t\t\tconsole.error(new Error('Promise already done'));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tself.done = true;\n\t\t\t\treturn func.apply(this, arguments);\n\t\t\t}\n\t\t}\n\n\t\tself.promise = new Promise(\n\t\t\t(resolve, reject) => {\n\t\t\t\tself.resolve = wrapper(resolve);\n\t\t\t\tself.reject = wrapper(reject);\n\t\t\t}\n\t\t);\n\n\t\tself.promise.isPending = () => { return !self.done };\n\t\treturn self;\n\t}\n}\n\nfunction logGroup(group, level, args) {\n\tconsole.group(group);\n\tconsole[level].apply(this, args);\n\tconsole.groupEnd();\n}\n\nfunction log() {\n\tif (!WSRPC.DEBUG) return;\n\tlogGroup('WSRPC.DEBUG', 'trace', arguments);\n}\n\nfunction trace (msg) {\n\tif (!WSRPC.TRACE) return;\n\n\tlet payload = msg;\n\tif ('data' in msg) payload = JSON.parse(msg.data);\n\tlogGroup(\"WSRPC.TRACE\", 'trace', [payload]);\n}\n\nfunction getAbsoluteWsUrl(url) {\n\tif ((/^\\w+:\\/\\//).test(url)) return url;\n\tif (typeof window == 'undefined' && window.location.host.length < 1)\n\t\tthrow new Error(\n\t\t\t`Can not construct absolute URL from ${window.location}`\n\t\t);\n\tconst scheme = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n\tconst port = window.location.port === '' ? `:${window.location.port}` : '';\n\tconst host = window.location.host;\n\tconst path = url.replace(/^\\/+/gm, '');\n\treturn `${scheme}//${host}${port}/${path}`;\n}\n\nfunction buildProxyMethodHandler(property){\n  return {\n    get: (handler, childProperty) => {\n      if (childProperty in handler) {\n        return handler[childProperty];\n      }\n      const newProperty = property ? `${property}.${childProperty}` : childProperty;\n      return new Proxy(\n        handler,\n        buildProxyMethodHandler(newProperty),\n      );\n    },\n    apply: function (target, thisArg, args) {\n      return target(property, ...args);\n    },\n  };\n}\n\nconst readyState = Object.freeze({\n\t0: 'CONNECTING',\n\t1: 'OPEN',\n\t2: 'CLOSING',\n\t3: 'CLOSED'\n});\n\nclass WSRPC {\n\tconstructor (URL, reconnectTimeout = 1000) {\n\t\tlet self = this;\n\n\t\tURL = getAbsoluteWsUrl(URL);\n\n\t\tself.id = 1;\n\t\tself.eventId = 0;\n\t\tself.socketStarted = false;\n\t\tself.eventStore = {\n\t\t\tonconnect: {},\n\t\t\tonerror: {},\n\t\t\tonclose: {},\n\t\t\tonchange: {}\n\t\t};\n\t\tself.connectionNumber = 0;\n\t\tself.oneTimeEventStore = {\n\t\t\tonconnect: [],\n\t\t\tonerror: [],\n\t\t\tonclose: [],\n\t\t\tonchange: []\n\t\t};\n\n\t\tself.callQueue = [];\n\n\t\tfunction createSocket() {\n\t\t\tlet ws = new WebSocket(URL);\n\n\t\t\tlet rejectQueue = function () {\n\t\t\t\tself.connectionNumber++; // rejects incoming calls\n\t\t\t\tlet deferred;\n\n\t\t\t\t//reject all pending calls\n\t\t\t\twhile (0 < self.callQueue.length) {\n\t\t\t\t\tlet callObj = self.callQueue.shift();\n\t\t\t\t\tdeferred = self.store[callObj.id];\n\t\t\t\t\tdelete self.store[callObj.id];\n\n\t\t\t\t\tif (deferred && deferred.promise.isPending()) {\n\t\t\t\t\t\tdeferred.reject('WebSocket error occurred');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// reject all from the store\n\t\t\t\tfor (let key in self.store) {\n\t\t\t\t\tif (!self.store.hasOwnProperty(key)) continue;\n\n\t\t\t\t\tdeferred = self.store[key];\n\t\t\t\t\tif (deferred && deferred.promise.isPending()) {\n\t\t\t\t\t\tdeferred.reject('WebSocket error occurred');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tfunction reconnect(callEvents) {\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tself.socket = createSocket();\n\t\t\t\t\t\tself.id = 1;\n\t\t\t\t\t} catch (exc) {\n\t\t\t\t\t\tcallEvents('onerror', exc);\n\t\t\t\t\t\tdelete self.socket;\n\t\t\t\t\t\tconsole.error(exc);\n\t\t\t\t\t}\n\t\t\t\t}, reconnectTimeout);\n\t\t\t}\n\n\t\t\tws.onclose = function (err) {\n\t\t\t\tlog('ONCLOSE CALLED', 'STATE', self.public.state());\n\t\t\t\ttrace(err);\n\n\t\t\t\tfor (let serial in self.store) {\n\t\t\t\t\tif (!self.store.hasOwnProperty(serial)) continue;\n\t\t\t\t\tif (self.store[serial].hasOwnProperty('reject')) {\n\t\t\t\t\t\tself.store[serial].reject('Connection closed');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\trejectQueue();\n\t\t\t\tcallEvents('onclose', err);\n\t\t\t\tcallEvents('onchange', err);\n\t\t\t\treconnect(callEvents);\n\t\t\t};\n\n\t\t\tws.onerror = function (err) {\n\t\t\t\tlog('ONERROR CALLED', 'STATE', self.public.state());\n\t\t\t\ttrace(err);\n\n\t\t\t\trejectQueue();\n\t\t\t\tcallEvents('onerror', err);\n\t\t\t\tcallEvents('onchange', err);\n\n\t\t\t\tlog('WebSocket has been closed by error: ', err);\n\t\t\t};\n\n\t\t\tfunction tryCallEvent(func, event) {\n\t\t\t\ttry {\n\t\t\t\t\treturn func(event);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (e.hasOwnProperty('stack')) {\n\t\t\t\t\t\tlog(e.stack);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlog('Event function', func, 'raised unknown error:', e);\n\t\t\t\t\t}\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction callEvents(evName, event) {\n\t\t\t\twhile (0 < self.oneTimeEventStore[evName].length) {\n\t\t\t\t\tlet deferred = self.oneTimeEventStore[evName].shift();\n\t\t\t\t\tif (deferred.hasOwnProperty('resolve') &&\n\t\t\t\t\t\tdeferred.promise.isPending()) deferred.resolve();\n\t\t\t\t}\n\n\t\t\t\tfor (let i in self.eventStore[evName]) {\n\t\t\t\t\tif (!self.eventStore[evName].hasOwnProperty(i)) continue;\n\t\t\t\t\tlet cur = self.eventStore[evName][i];\n\t\t\t\t\ttryCallEvent(cur, event);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tws.onopen = function (ev) {\n\t\t\t\tlog('ONOPEN CALLED', 'STATE', self.public.state());\n\t\t\t\ttrace(ev);\n\n\t\t\t\twhile (0 < self.callQueue.length) {\n\t\t\t\t\t// noinspection JSUnresolvedFunction\n\t\t\t\t\tself.socket.send(JSON.stringify(self.callQueue.shift(), 0, 1));\n\t\t\t\t}\n\n\t\t\t\tcallEvents('onconnect', ev);\n\t\t\t\tcallEvents('onchange', ev);\n\t\t\t};\n\n\t\t\tfunction handleCall(self, data) {\n\t\t\t\tif (!self.routes.hasOwnProperty(data.method))\n\t\t\t\t\tthrow new Error('Route not found');\n\n\t\t\t\tlet connectionNumber = self.connectionNumber;\n\t\t\t\tlet deferred = new Deferred();\n\n\t\t\t\tdeferred.promise.then(\n\t\t\t\t\tfunction (result) {\n\t\t\t\t\t\tif (connectionNumber !== self.connectionNumber) return;\n\t\t\t\t\t\tself.socket.send(JSON.stringify({\n\t\t\t\t\t\t\tid: data.id,\n\t\t\t\t\t\t\tresult: result || null\n\t\t\t\t\t\t}));\n\t\t\t\t\t},\n\t\t\t\t\tfunction (error) {\n\t\t\t\t\t\tif (connectionNumber !== self.connectionNumber) return;\n\t\t\t\t\t\tself.socket.send(JSON.stringify({\n\t\t\t\t\t\t\tid: data.id,\n\t\t\t\t\t\t\terror: error || null\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tlet func = self.routes[data.method];\n\n\t\t\t\tif (self.asyncRoutes[data.method])\n\t\t\t\t\treturn func.apply(deferred, [data.params]);\n\n\t\t\t\tfunction badPromise() {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\"You should register route with async flag.\"\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tlet promiseMock = {\n\t\t\t\t\tresolve: badPromise,\n\t\t\t\t\treject: badPromise,\n\t\t\t\t};\n\n\t\t\t\ttry {\n\t\t\t\t\tdeferred.resolve(func.apply(promiseMock, [data.params]));\n\t\t\t\t} catch (e) {\n\t\t\t\t\tdeferred.reject(e);\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction handleError(self, data) {\n\t\t\t\tif (!self.store.hasOwnProperty(data.id))\n\t\t\t\t\treturn log('Unknown callback');\n\n\t\t\t\tlet deferred = self.store[data.id];\n\n\t\t\t\tif (typeof deferred === 'undefined')\n\t\t\t\t\treturn log('Confirmation without handler');\n\n\t\t\t\tdelete self.store[data.id];\n\t\t\t\tlog('REJECTING', data.error);\n\t\t\t\tdeferred.reject(data.error);\n\t\t\t}\n\n\t\t\tfunction handleResult(self, data) {\n\t\t\t\tlet deferred = self.store[data.id];\n\t\t\t\tif (typeof deferred === 'undefined')\n\t\t\t\t\treturn log('Confirmation without handler');\n\n\t\t\t\tdelete self.store[data.id];\n\n\t\t\t\tif (data.hasOwnProperty('result')) {\n\t\t\t\t\treturn deferred.resolve(data.result);\n\t\t\t\t}\n\t\t\t\treturn deferred.reject(data.error);\n\t\t\t}\n\n\t\t\tws.onmessage = function (message) {\n\t\t\t\tlog('ONMESSAGE CALLED', 'STATE', self.public.state());\n\t\t\t\ttrace(message);\n\n\t\t\t\tif (message.type !== 'message') return;\n\n\t\t\t\tlet data;\n\n\t\t\t\ttry {\n\t\t\t\t\tdata = JSON.parse(message.data);\n\t\t\t\t\tlog(data);\n\n\t\t\t\t\tif (!data.hasOwnProperty('id')) {\n\t\t\t\t\t\tlet current;\n\n\t\t\t\t\t\tconsole.group(\"Event received\");\n\t\t\t\t\t\tfor (let i = 0; i < self.socketEventsListeners.length; i++) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tcurrent = self.socketEventsListeners[i];\n\t\t\t\t\t\t\t\tcurrent.apply(self.public, [data]);\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconsole.groupEnd();\n\t\t\t\t\t} else if (data.hasOwnProperty('method')) {\n\t\t\t\t\t\treturn handleCall(self, data);\n\t\t\t\t\t} else if (data.hasOwnProperty('error') && data.error === null) {\n\t\t\t\t\t\treturn handleError(self, data);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn handleResult(self, data);\n\t\t\t\t\t}\n\t\t\t\t} catch (exception) {\n\t\t\t\t\tlet err = {\n\t\t\t\t\t\terror: exception.message,\n\t\t\t\t\t\tresult: null,\n\t\t\t\t\t\tid: data ? data.id : null\n\t\t\t\t\t};\n\n\t\t\t\t\tself.socket.send(JSON.stringify(err));\n\t\t\t\t\tconsole.error(exception);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn ws;\n\t\t}\n\n\t\tfunction makeCall(func, args, params) {\n\t\t\tself.id += 2;\n\t\t\tlet deferred = new Deferred();\n\n\t\t\tlet callObj = Object.freeze({\n\t\t\t\tid: self.id,\n\t\t\t\tmethod: func,\n\t\t\t\tparams: args\n\t\t\t});\n\n\t\t\tlet state = self.public.state();\n\n\t\t\tif (state === 'OPEN') {\n\t\t\t\tself.store[self.id] = deferred;\n\t\t\t\tself.socket.send(JSON.stringify(callObj));\n\t\t\t} else if (state === 'CONNECTING') {\n\t\t\t\tlog('SOCKET IS', state);\n\t\t\t\tself.store[self.id] = deferred;\n\t\t\t\tself.callQueue.push(callObj);\n\t\t\t} else {\n\t\t\t\tlog('SOCKET IS', state);\n\t\t\t\tif (params && params['noWait']) {\n\t\t\t\t\tdeferred.reject(`Socket is: ${state}`);\n\t\t\t\t} else {\n\t\t\t\t\tself.store[self.id] = deferred;\n\t\t\t\t\tself.callQueue.push(callObj);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\tself.socketEventsListeners = [function (event) {console.log(event);}];\n\t\tself.asyncRoutes = {};\n\t\tself.routes = {};\n\t\tself.store = {};\n\t\tself.public = Object.freeze({\n            defer: function () {\n                return new Deferred();\n            },\n\t\t\tcall: function (func, args, params) {\n\t\t\t\treturn makeCall(func, args, params);\n\t\t\t},\n\t\t\tproxy: new Proxy(makeCall, buildProxyMethodHandler()),\n\t\t\taddRoute: function (route, callback, isAsync) {\n\t\t\t\tself.asyncRoutes[route] = isAsync || false;\n\t\t\t\tself.routes[route] = callback;\n\t\t\t},\n\t\t\tdeleteRoute: function (route) {\n\t\t\t\tdelete self.asyncRoutes[route];\n\t\t\t\treturn delete self.routes[route];\n\t\t\t},\n\t\t\taddEventListener: function (event, func) {\n\t\t\t\tlet eventId = self.eventId++;\n\t\t\t\tself.eventStore[event][eventId] = func;\n\t\t\t\treturn eventId;\n\t\t\t},\n\t\t\tremoveEventListener: function (event, index) {\n\t\t\t\tif (self.eventStore[event].hasOwnProperty(index)) {\n\t\t\t\t\tdelete self.eventStore[event][index];\n\t\t\t\t\treturn true;\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t},\n\t\t\tonEvent: function (event) {\n\t\t\t\tlet deferred = new Deferred();\n\t\t\t\tself.oneTimeEventStore[event].push(deferred);\n\t\t\t\treturn deferred.promise;\n\t\t\t},\n\t\t\tdestroy: function () {\n\t\t\t\treturn self.socket.close();\n\t\t\t},\n\t\t\tstate: function () {\n\t\t\t\treturn readyState[this.stateCode()];\n\t\t\t},\n\t\t\tstateCode: function () {\n\t\t\t\tif (self.socketStarted && self.socket)\n\t\t\t\t\treturn self.socket.readyState;\n\t\t\t\treturn 3;\n\t\t\t},\n\t\t\tconnect: function () {\n\t\t\t\tself.socketStarted = true;\n\t\t\t\tself.socket = createSocket();\n\t\t\t},\n\t\t\taddServerEventListener: function (callable) {\n\t\t\t\treturn self.socketEventsListeners.push(callable) - 1;\n\t\t\t},\n\t\t\tremoveServerEventListener: function (index) {\n\t\t\t    return self.socketEventsListeners.splice(index, 1).length;\n\t\t\t},\n            sendRaw: function (data) {\n                return self.socket.send(data);\n            }\n\t\t});\n\n\t\tself.public.addRoute('log', function (argsObj) {\n\t\t\tconsole.info(`Websocket sent: ${argsObj}`);\n\t\t});\n\n\t\tself.public.addRoute('ping', function (data) {\n\t\t\treturn data;\n\t\t});\n\n\t\treturn self.public;\n\t}\n}\n\nWSRPC.DEBUG = false;\nWSRPC.TRACE = false;\n\nexport default WSRPC;\n"],"names":["Deferred","self","resolve","reject","done","wrapper","func","console","error","Error","apply","arguments","promise","Promise","isPending","logGroup","group","level","args","groupEnd","log","WSRPC","DEBUG","trace","msg","TRACE","payload","JSON","parse","data","getAbsoluteWsUrl","url","test","window","location","host","length","scheme","protocol","port","path","replace","buildProxyMethodHandler","property","get","handler","childProperty","newProperty","Proxy","target","thisArg","readyState","Object","freeze","URL","reconnectTimeout","id","eventId","socketStarted","eventStore","onconnect","onerror","onclose","onchange","connectionNumber","oneTimeEventStore","callQueue","createSocket","ws","WebSocket","rejectQueue","deferred","callObj","shift","store","key","hasOwnProperty","reconnect","callEvents","setTimeout","socket","exc","err","public","state","serial","tryCallEvent","event","e","stack","evName","i","cur","onopen","ev","send","stringify","handleCall","routes","method","then","result","asyncRoutes","params","badPromise","promiseMock","handleError","handleResult","onmessage","message","type","current","socketEventsListeners","exception","makeCall","push","defer","call","proxy","addRoute","route","callback","isAsync","deleteRoute","addEventListener","removeEventListener","index","onEvent","destroy","close","stateCode","connect","addServerEventListener","callable","removeServerEventListener","splice","sendRaw","argsObj","info"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAAMA,WACL,oBAAc;EAAA;;EACb,MAAMC,IAAI,GAAG,IAAb;EAEAA,EAAAA,IAAI,CAACC,OAAL,GAAe,IAAf;EACAD,EAAAA,IAAI,CAACE,MAAL,GAAc,IAAd;EACAF,EAAAA,IAAI,CAACG,IAAL,GAAY,KAAZ;;EAEA,WAASC,OAAT,CAAiBC,IAAjB,EAAuB;EACtB,WAAO,YAAY;EAClB,UAAIL,IAAI,CAACG,IAAT,EAAe;EACdG,QAAAA,OAAO,CAACC,KAAR,CAAc,IAAIC,KAAJ,CAAU,sBAAV,CAAd;EACA;EACA;;EACDR,MAAAA,IAAI,CAACG,IAAL,GAAY,IAAZ;EACA,aAAOE,IAAI,CAACI,KAAL,CAAW,IAAX,EAAiBC,SAAjB,CAAP;EACA,KAPD;EAQA;;EAEDV,EAAAA,IAAI,CAACW,OAAL,GAAe,IAAIC,OAAJ,CACd,UAACX,OAAD,EAAUC,MAAV,EAAqB;EACpBF,IAAAA,IAAI,CAACC,OAAL,GAAeG,OAAO,CAACH,OAAD,CAAtB;EACAD,IAAAA,IAAI,CAACE,MAAL,GAAcE,OAAO,CAACF,MAAD,CAArB;EACA,GAJa,CAAf;;EAOAF,EAAAA,IAAI,CAACW,OAAL,CAAaE,SAAb,GAAyB,YAAM;EAAE,WAAO,CAACb,IAAI,CAACG,IAAb;EAAmB,GAApD;;EACA,SAAOH,IAAP;EACA;;EAGF,SAASc,QAAT,CAAkBC,KAAlB,EAAyBC,KAAzB,EAAgCC,IAAhC,EAAsC;EACrCX,EAAAA,OAAO,CAACS,KAAR,CAAcA,KAAd;EACAT,EAAAA,OAAO,CAACU,KAAD,CAAP,CAAeP,KAAf,CAAqB,IAArB,EAA2BQ,IAA3B;EACAX,EAAAA,OAAO,CAACY,QAAR;EACA;;EAED,SAASC,GAAT,GAAe;EACd,MAAI,CAACC,KAAK,CAACC,KAAX,EAAkB;EAClBP,EAAAA,QAAQ,CAAC,aAAD,EAAgB,OAAhB,EAAyBJ,SAAzB,CAAR;EACA;;EAED,SAASY,KAAT,CAAgBC,GAAhB,EAAqB;EACpB,MAAI,CAACH,KAAK,CAACI,KAAX,EAAkB;EAElB,MAAIC,OAAO,GAAGF,GAAd;EACA,MAAI,UAAUA,GAAd,EAAmBE,OAAO,GAAGC,IAAI,CAACC,KAAL,CAAWJ,GAAG,CAACK,IAAf,CAAV;EACnBd,EAAAA,QAAQ,CAAC,aAAD,EAAgB,OAAhB,EAAyB,CAACW,OAAD,CAAzB,CAAR;EACA;;EAED,SAASI,gBAAT,CAA0BC,GAA1B,EAA+B;EAC9B,MAAK,WAAD,CAAcC,IAAd,CAAmBD,GAAnB,CAAJ,EAA6B,OAAOA,GAAP;EAC7B,MAAI,OAAOE,MAAP,IAAiB,WAAjB,IAAgCA,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,MAArB,GAA8B,CAAlE,EACC,MAAM,IAAI3B,KAAJ,+CACkCwB,MAAM,CAACC,QADzC,EAAN;EAGD,MAAMG,MAAM,GAAGJ,MAAM,CAACC,QAAP,CAAgBI,QAAhB,KAA6B,QAA7B,GAAwC,MAAxC,GAAiD,KAAhE;EACA,MAAMC,IAAI,GAAGN,MAAM,CAACC,QAAP,CAAgBK,IAAhB,KAAyB,EAAzB,cAAkCN,MAAM,CAACC,QAAP,CAAgBK,IAAlD,IAA2D,EAAxE;EACA,MAAMJ,IAAI,GAAGF,MAAM,CAACC,QAAP,CAAgBC,IAA7B;EACA,MAAMK,IAAI,GAAGT,GAAG,CAACU,OAAJ,CAAY,QAAZ,EAAsB,EAAtB,CAAb;EACA,mBAAUJ,MAAV,eAAqBF,IAArB,SAA4BI,IAA5B,cAAoCC,IAApC;EACA;;EAED,SAASE,uBAAT,CAAiCC,QAAjC,EAA0C;EACxC,SAAO;EACLC,IAAAA,GAAG,EAAE,aAACC,OAAD,EAAUC,aAAV,EAA4B;EAC/B,UAAIA,aAAa,IAAID,OAArB,EAA8B;EAC5B,eAAOA,OAAO,CAACC,aAAD,CAAd;EACD;;EACD,UAAMC,WAAW,GAAGJ,QAAQ,aAAMA,QAAN,cAAkBG,aAAlB,IAAoCA,aAAhE;EACA,aAAO,IAAIE,KAAJ,CACLH,OADK,EAELH,uBAAuB,CAACK,WAAD,CAFlB,CAAP;EAID,KAVI;EAWLrC,IAAAA,KAAK,EAAE,eAAUuC,MAAV,EAAkBC,OAAlB,EAA2BhC,IAA3B,EAAiC;EACtC,aAAO+B,MAAM,MAAN,UAAON,QAAP,4BAAoBzB,IAApB,GAAP;EACD;EAbI,GAAP;EAeD;;EAED,IAAMiC,UAAU,GAAGC,MAAM,CAACC,MAAP,CAAc;EAChC,KAAG,YAD6B;EAEhC,KAAG,MAF6B;EAGhC,KAAG,SAH6B;EAIhC,KAAG;EAJ6B,CAAd,CAAnB;;MAOMhC,QACL,eAAaiC,GAAb,EAA2C;EAAA,MAAzBC,gBAAyB,uEAAN,IAAM;;EAAA;;EAC1C,MAAItD,IAAI,GAAG,IAAX;EAEAqD,EAAAA,GAAG,GAAGxB,gBAAgB,CAACwB,GAAD,CAAtB;EAEArD,EAAAA,IAAI,CAACuD,EAAL,GAAU,CAAV;EACAvD,EAAAA,IAAI,CAACwD,OAAL,GAAe,CAAf;EACAxD,EAAAA,IAAI,CAACyD,aAAL,GAAqB,KAArB;EACAzD,EAAAA,IAAI,CAAC0D,UAAL,GAAkB;EACjBC,IAAAA,SAAS,EAAE,EADM;EAEjBC,IAAAA,OAAO,EAAE,EAFQ;EAGjBC,IAAAA,OAAO,EAAE,EAHQ;EAIjBC,IAAAA,QAAQ,EAAE;EAJO,GAAlB;EAMA9D,EAAAA,IAAI,CAAC+D,gBAAL,GAAwB,CAAxB;EACA/D,EAAAA,IAAI,CAACgE,iBAAL,GAAyB;EACxBL,IAAAA,SAAS,EAAE,EADa;EAExBC,IAAAA,OAAO,EAAE,EAFe;EAGxBC,IAAAA,OAAO,EAAE,EAHe;EAIxBC,IAAAA,QAAQ,EAAE;EAJc,GAAzB;EAOA9D,EAAAA,IAAI,CAACiE,SAAL,GAAiB,EAAjB;;EAEA,WAASC,YAAT,GAAwB;EACvB,QAAIC,EAAE,GAAG,IAAIC,SAAJ,CAAcf,GAAd,CAAT;;EAEA,QAAIgB,WAAW,GAAG,SAAdA,WAAc,GAAY;EAC7BrE,MAAAA,IAAI,CAAC+D,gBAAL,GAD6B;;EAE7B,UAAIO,QAAJ,CAF6B;;EAK7B,aAAO,IAAItE,IAAI,CAACiE,SAAL,CAAe9B,MAA1B,EAAkC;EACjC,YAAIoC,OAAO,GAAGvE,IAAI,CAACiE,SAAL,CAAeO,KAAf,EAAd;EACAF,QAAAA,QAAQ,GAAGtE,IAAI,CAACyE,KAAL,CAAWF,OAAO,CAAChB,EAAnB,CAAX;EACA,eAAOvD,IAAI,CAACyE,KAAL,CAAWF,OAAO,CAAChB,EAAnB,CAAP;;EAEA,YAAIe,QAAQ,IAAIA,QAAQ,CAAC3D,OAAT,CAAiBE,SAAjB,EAAhB,EAA8C;EAC7CyD,UAAAA,QAAQ,CAACpE,MAAT,CAAgB,0BAAhB;EACA;EACD,OAb4B;;;EAgB7B,WAAK,IAAIwE,GAAT,IAAgB1E,IAAI,CAACyE,KAArB,EAA4B;EAC3B,YAAI,CAACzE,IAAI,CAACyE,KAAL,CAAWE,cAAX,CAA0BD,GAA1B,CAAL,EAAqC;EAErCJ,QAAAA,QAAQ,GAAGtE,IAAI,CAACyE,KAAL,CAAWC,GAAX,CAAX;;EACA,YAAIJ,QAAQ,IAAIA,QAAQ,CAAC3D,OAAT,CAAiBE,SAAjB,EAAhB,EAA8C;EAC7CyD,UAAAA,QAAQ,CAACpE,MAAT,CAAgB,0BAAhB;EACA;EACD;EACD,KAxBD;;EA0BA,aAAS0E,SAAT,CAAmBC,UAAnB,EAA+B;EAC9BC,MAAAA,UAAU,CAAC,YAAY;EACtB,YAAI;EACH9E,UAAAA,IAAI,CAAC+E,MAAL,GAAcb,YAAY,EAA1B;EACAlE,UAAAA,IAAI,CAACuD,EAAL,GAAU,CAAV;EACA,SAHD,CAGE,OAAOyB,GAAP,EAAY;EACbH,UAAAA,UAAU,CAAC,SAAD,EAAYG,GAAZ,CAAV;EACA,iBAAOhF,IAAI,CAAC+E,MAAZ;EACAzE,UAAAA,OAAO,CAACC,KAAR,CAAcyE,GAAd;EACA;EACD,OATS,EASP1B,gBATO,CAAV;EAUA;;EAEDa,IAAAA,EAAE,CAACN,OAAH,GAAa,UAAUoB,GAAV,EAAe;EAC3B9D,MAAAA,GAAG,CAAC,gBAAD,EAAmB,OAAnB,EAA4BnB,IAAI,CAACkF,MAAL,CAAYC,KAAZ,EAA5B,CAAH;EACA7D,MAAAA,KAAK,CAAC2D,GAAD,CAAL;;EAEA,WAAK,IAAIG,MAAT,IAAmBpF,IAAI,CAACyE,KAAxB,EAA+B;EAC9B,YAAI,CAACzE,IAAI,CAACyE,KAAL,CAAWE,cAAX,CAA0BS,MAA1B,CAAL,EAAwC;;EACxC,YAAIpF,IAAI,CAACyE,KAAL,CAAWW,MAAX,EAAmBT,cAAnB,CAAkC,QAAlC,CAAJ,EAAiD;EAChD3E,UAAAA,IAAI,CAACyE,KAAL,CAAWW,MAAX,EAAmBlF,MAAnB,CAA0B,mBAA1B;EACA;EACD;;EAEDmE,MAAAA,WAAW;EACXQ,MAAAA,UAAU,CAAC,SAAD,EAAYI,GAAZ,CAAV;EACAJ,MAAAA,UAAU,CAAC,UAAD,EAAaI,GAAb,CAAV;EACAL,MAAAA,SAAS,CAACC,UAAD,CAAT;EACA,KAfD;;EAiBAV,IAAAA,EAAE,CAACP,OAAH,GAAa,UAAUqB,GAAV,EAAe;EAC3B9D,MAAAA,GAAG,CAAC,gBAAD,EAAmB,OAAnB,EAA4BnB,IAAI,CAACkF,MAAL,CAAYC,KAAZ,EAA5B,CAAH;EACA7D,MAAAA,KAAK,CAAC2D,GAAD,CAAL;EAEAZ,MAAAA,WAAW;EACXQ,MAAAA,UAAU,CAAC,SAAD,EAAYI,GAAZ,CAAV;EACAJ,MAAAA,UAAU,CAAC,UAAD,EAAaI,GAAb,CAAV;EAEA9D,MAAAA,GAAG,CAAC,sCAAD,EAAyC8D,GAAzC,CAAH;EACA,KATD;;EAWA,aAASI,YAAT,CAAsBhF,IAAtB,EAA4BiF,KAA5B,EAAmC;EAClC,UAAI;EACH,eAAOjF,IAAI,CAACiF,KAAD,CAAX;EACA,OAFD,CAEE,OAAOC,CAAP,EAAU;EACX,YAAIA,CAAC,CAACZ,cAAF,CAAiB,OAAjB,CAAJ,EAA+B;EAC9BxD,UAAAA,GAAG,CAACoE,CAAC,CAACC,KAAH,CAAH;EACA,SAFD,MAEO;EACNrE,UAAAA,GAAG,CAAC,gBAAD,EAAmBd,IAAnB,EAAyB,uBAAzB,EAAkDkF,CAAlD,CAAH;EACA;;EACDjF,QAAAA,OAAO,CAACC,KAAR,CAAcgF,CAAd;EACA;EACD;;EAED,aAASV,UAAT,CAAoBY,MAApB,EAA4BH,KAA5B,EAAmC;EAClC,aAAO,IAAItF,IAAI,CAACgE,iBAAL,CAAuByB,MAAvB,EAA+BtD,MAA1C,EAAkD;EACjD,YAAImC,QAAQ,GAAGtE,IAAI,CAACgE,iBAAL,CAAuByB,MAAvB,EAA+BjB,KAA/B,EAAf;EACA,YAAIF,QAAQ,CAACK,cAAT,CAAwB,SAAxB,KACHL,QAAQ,CAAC3D,OAAT,CAAiBE,SAAjB,EADD,EAC+ByD,QAAQ,CAACrE,OAAT;EAC/B;;EAED,WAAK,IAAIyF,CAAT,IAAc1F,IAAI,CAAC0D,UAAL,CAAgB+B,MAAhB,CAAd,EAAuC;EACtC,YAAI,CAACzF,IAAI,CAAC0D,UAAL,CAAgB+B,MAAhB,EAAwBd,cAAxB,CAAuCe,CAAvC,CAAL,EAAgD;EAChD,YAAIC,GAAG,GAAG3F,IAAI,CAAC0D,UAAL,CAAgB+B,MAAhB,EAAwBC,CAAxB,CAAV;EACAL,QAAAA,YAAY,CAACM,GAAD,EAAML,KAAN,CAAZ;EACA;EACD;;EAEDnB,IAAAA,EAAE,CAACyB,MAAH,GAAY,UAAUC,EAAV,EAAc;EACzB1E,MAAAA,GAAG,CAAC,eAAD,EAAkB,OAAlB,EAA2BnB,IAAI,CAACkF,MAAL,CAAYC,KAAZ,EAA3B,CAAH;EACA7D,MAAAA,KAAK,CAACuE,EAAD,CAAL;;EAEA,aAAO,IAAI7F,IAAI,CAACiE,SAAL,CAAe9B,MAA1B,EAAkC;EACjC;EACAnC,QAAAA,IAAI,CAAC+E,MAAL,CAAYe,IAAZ,CAAiBpE,IAAI,CAACqE,SAAL,CAAe/F,IAAI,CAACiE,SAAL,CAAeO,KAAf,EAAf,EAAuC,CAAvC,EAA0C,CAA1C,CAAjB;EACA;;EAEDK,MAAAA,UAAU,CAAC,WAAD,EAAcgB,EAAd,CAAV;EACAhB,MAAAA,UAAU,CAAC,UAAD,EAAagB,EAAb,CAAV;EACA,KAXD;;EAaA,aAASG,UAAT,CAAoBhG,IAApB,EAA0B4B,IAA1B,EAAgC;EAC/B,UAAI,CAAC5B,IAAI,CAACiG,MAAL,CAAYtB,cAAZ,CAA2B/C,IAAI,CAACsE,MAAhC,CAAL,EACC,MAAM,IAAI1F,KAAJ,CAAU,iBAAV,CAAN;EAED,UAAIuD,gBAAgB,GAAG/D,IAAI,CAAC+D,gBAA5B;EACA,UAAIO,QAAQ,GAAG,IAAIvE,QAAJ,EAAf;EAEAuE,MAAAA,QAAQ,CAAC3D,OAAT,CAAiBwF,IAAjB,CACC,UAAUC,MAAV,EAAkB;EACjB,YAAIrC,gBAAgB,KAAK/D,IAAI,CAAC+D,gBAA9B,EAAgD;EAChD/D,QAAAA,IAAI,CAAC+E,MAAL,CAAYe,IAAZ,CAAiBpE,IAAI,CAACqE,SAAL,CAAe;EAC/BxC,UAAAA,EAAE,EAAE3B,IAAI,CAAC2B,EADsB;EAE/B6C,UAAAA,MAAM,EAAEA,MAAM,IAAI;EAFa,SAAf,CAAjB;EAIA,OAPF,EAQC,UAAU7F,KAAV,EAAiB;EAChB,YAAIwD,gBAAgB,KAAK/D,IAAI,CAAC+D,gBAA9B,EAAgD;EAChD/D,QAAAA,IAAI,CAAC+E,MAAL,CAAYe,IAAZ,CAAiBpE,IAAI,CAACqE,SAAL,CAAe;EAC/BxC,UAAAA,EAAE,EAAE3B,IAAI,CAAC2B,EADsB;EAE/BhD,UAAAA,KAAK,EAAEA,KAAK,IAAI;EAFe,SAAf,CAAjB;EAIA,OAdF;EAiBA,UAAIF,IAAI,GAAGL,IAAI,CAACiG,MAAL,CAAYrE,IAAI,CAACsE,MAAjB,CAAX;EAEA,UAAIlG,IAAI,CAACqG,WAAL,CAAiBzE,IAAI,CAACsE,MAAtB,CAAJ,EACC,OAAO7F,IAAI,CAACI,KAAL,CAAW6D,QAAX,EAAqB,CAAC1C,IAAI,CAAC0E,MAAN,CAArB,CAAP;;EAED,eAASC,UAAT,GAAsB;EACrB,cAAM,IAAI/F,KAAJ,CACL,4CADK,CAAN;EAGA;;EAED,UAAIgG,WAAW,GAAG;EACjBvG,QAAAA,OAAO,EAAEsG,UADQ;EAEjBrG,QAAAA,MAAM,EAAEqG;EAFS,OAAlB;;EAKA,UAAI;EACHjC,QAAAA,QAAQ,CAACrE,OAAT,CAAiBI,IAAI,CAACI,KAAL,CAAW+F,WAAX,EAAwB,CAAC5E,IAAI,CAAC0E,MAAN,CAAxB,CAAjB;EACA,OAFD,CAEE,OAAOf,CAAP,EAAU;EACXjB,QAAAA,QAAQ,CAACpE,MAAT,CAAgBqF,CAAhB;EACAjF,QAAAA,OAAO,CAACC,KAAR,CAAcgF,CAAd;EACA;EACD;;EAED,aAASkB,WAAT,CAAqBzG,IAArB,EAA2B4B,IAA3B,EAAiC;EAChC,UAAI,CAAC5B,IAAI,CAACyE,KAAL,CAAWE,cAAX,CAA0B/C,IAAI,CAAC2B,EAA/B,CAAL,EACC,OAAOpC,GAAG,CAAC,kBAAD,CAAV;EAED,UAAImD,QAAQ,GAAGtE,IAAI,CAACyE,KAAL,CAAW7C,IAAI,CAAC2B,EAAhB,CAAf;EAEA,UAAI,OAAOe,QAAP,KAAoB,WAAxB,EACC,OAAOnD,GAAG,CAAC,8BAAD,CAAV;EAED,aAAOnB,IAAI,CAACyE,KAAL,CAAW7C,IAAI,CAAC2B,EAAhB,CAAP;EACApC,MAAAA,GAAG,CAAC,WAAD,EAAcS,IAAI,CAACrB,KAAnB,CAAH;EACA+D,MAAAA,QAAQ,CAACpE,MAAT,CAAgB0B,IAAI,CAACrB,KAArB;EACA;;EAED,aAASmG,YAAT,CAAsB1G,IAAtB,EAA4B4B,IAA5B,EAAkC;EACjC,UAAI0C,QAAQ,GAAGtE,IAAI,CAACyE,KAAL,CAAW7C,IAAI,CAAC2B,EAAhB,CAAf;EACA,UAAI,OAAOe,QAAP,KAAoB,WAAxB,EACC,OAAOnD,GAAG,CAAC,8BAAD,CAAV;EAED,aAAOnB,IAAI,CAACyE,KAAL,CAAW7C,IAAI,CAAC2B,EAAhB,CAAP;;EAEA,UAAI3B,IAAI,CAAC+C,cAAL,CAAoB,QAApB,CAAJ,EAAmC;EAClC,eAAOL,QAAQ,CAACrE,OAAT,CAAiB2B,IAAI,CAACwE,MAAtB,CAAP;EACA;;EACD,aAAO9B,QAAQ,CAACpE,MAAT,CAAgB0B,IAAI,CAACrB,KAArB,CAAP;EACA;;EAED4D,IAAAA,EAAE,CAACwC,SAAH,GAAe,UAAUC,OAAV,EAAmB;EACjCzF,MAAAA,GAAG,CAAC,kBAAD,EAAqB,OAArB,EAA8BnB,IAAI,CAACkF,MAAL,CAAYC,KAAZ,EAA9B,CAAH;EACA7D,MAAAA,KAAK,CAACsF,OAAD,CAAL;EAEA,UAAIA,OAAO,CAACC,IAAR,KAAiB,SAArB,EAAgC;EAEhC,UAAIjF,IAAJ;;EAEA,UAAI;EACHA,QAAAA,IAAI,GAAGF,IAAI,CAACC,KAAL,CAAWiF,OAAO,CAAChF,IAAnB,CAAP;EACAT,QAAAA,GAAG,CAACS,IAAD,CAAH;;EAEA,YAAI,CAACA,IAAI,CAAC+C,cAAL,CAAoB,IAApB,CAAL,EAAgC;EAC/B,cAAImC,OAAJ;EAEAxG,UAAAA,OAAO,CAACS,KAAR,CAAc,gBAAd;;EACA,eAAK,IAAI2E,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG1F,IAAI,CAAC+G,qBAAL,CAA2B5E,MAA/C,EAAuDuD,CAAC,EAAxD,EAA4D;EAC3D,gBAAI;EACHoB,cAAAA,OAAO,GAAG9G,IAAI,CAAC+G,qBAAL,CAA2BrB,CAA3B,CAAV;EACAoB,cAAAA,OAAO,CAACrG,KAAR,CAAcT,IAAI,CAACkF,MAAnB,EAA2B,CAACtD,IAAD,CAA3B;EACA,aAHD,CAGE,OAAO2D,CAAP,EAAU;EACXjF,cAAAA,OAAO,CAACC,KAAR,CAAcgF,CAAd;EACA;EACD;;EACDjF,UAAAA,OAAO,CAACY,QAAR;EACA,SAbD,MAaO,IAAIU,IAAI,CAAC+C,cAAL,CAAoB,QAApB,CAAJ,EAAmC;EACzC,iBAAOqB,UAAU,CAAChG,IAAD,EAAO4B,IAAP,CAAjB;EACA,SAFM,MAEA,IAAIA,IAAI,CAAC+C,cAAL,CAAoB,OAApB,KAAgC/C,IAAI,CAACrB,KAAL,KAAe,IAAnD,EAAyD;EAC/D,iBAAOkG,WAAW,CAACzG,IAAD,EAAO4B,IAAP,CAAlB;EACA,SAFM,MAEA;EACN,iBAAO8E,YAAY,CAAC1G,IAAD,EAAO4B,IAAP,CAAnB;EACA;EACD,OAxBD,CAwBE,OAAOoF,SAAP,EAAkB;EACnB,YAAI/B,GAAG,GAAG;EACT1E,UAAAA,KAAK,EAAEyG,SAAS,CAACJ,OADR;EAETR,UAAAA,MAAM,EAAE,IAFC;EAGT7C,UAAAA,EAAE,EAAE3B,IAAI,GAAGA,IAAI,CAAC2B,EAAR,GAAa;EAHZ,SAAV;EAMAvD,QAAAA,IAAI,CAAC+E,MAAL,CAAYe,IAAZ,CAAiBpE,IAAI,CAACqE,SAAL,CAAed,GAAf,CAAjB;EACA3E,QAAAA,OAAO,CAACC,KAAR,CAAcyG,SAAd;EACA;EACD,KA1CD;;EA4CA,WAAO7C,EAAP;EACA;;EAED,WAAS8C,QAAT,CAAkB5G,IAAlB,EAAwBY,IAAxB,EAA8BqF,MAA9B,EAAsC;EACrCtG,IAAAA,IAAI,CAACuD,EAAL,IAAW,CAAX;EACA,QAAIe,QAAQ,GAAG,IAAIvE,QAAJ,EAAf;EAEA,QAAIwE,OAAO,GAAGpB,MAAM,CAACC,MAAP,CAAc;EAC3BG,MAAAA,EAAE,EAAEvD,IAAI,CAACuD,EADkB;EAE3B2C,MAAAA,MAAM,EAAE7F,IAFmB;EAG3BiG,MAAAA,MAAM,EAAErF;EAHmB,KAAd,CAAd;EAMA,QAAIkE,KAAK,GAAGnF,IAAI,CAACkF,MAAL,CAAYC,KAAZ,EAAZ;;EAEA,QAAIA,KAAK,KAAK,MAAd,EAAsB;EACrBnF,MAAAA,IAAI,CAACyE,KAAL,CAAWzE,IAAI,CAACuD,EAAhB,IAAsBe,QAAtB;EACAtE,MAAAA,IAAI,CAAC+E,MAAL,CAAYe,IAAZ,CAAiBpE,IAAI,CAACqE,SAAL,CAAexB,OAAf,CAAjB;EACA,KAHD,MAGO,IAAIY,KAAK,KAAK,YAAd,EAA4B;EAClChE,MAAAA,GAAG,CAAC,WAAD,EAAcgE,KAAd,CAAH;EACAnF,MAAAA,IAAI,CAACyE,KAAL,CAAWzE,IAAI,CAACuD,EAAhB,IAAsBe,QAAtB;EACAtE,MAAAA,IAAI,CAACiE,SAAL,CAAeiD,IAAf,CAAoB3C,OAApB;EACA,KAJM,MAIA;EACNpD,MAAAA,GAAG,CAAC,WAAD,EAAcgE,KAAd,CAAH;;EACA,UAAImB,MAAM,IAAIA,MAAM,CAAC,QAAD,CAApB,EAAgC;EAC/BhC,QAAAA,QAAQ,CAACpE,MAAT,sBAA8BiF,KAA9B;EACA,OAFD,MAEO;EACNnF,QAAAA,IAAI,CAACyE,KAAL,CAAWzE,IAAI,CAACuD,EAAhB,IAAsBe,QAAtB;EACAtE,QAAAA,IAAI,CAACiE,SAAL,CAAeiD,IAAf,CAAoB3C,OAApB;EACA;EACD;;EAED,WAAOD,QAAQ,CAAC3D,OAAhB;EACA;;EAEDX,EAAAA,IAAI,CAAC+G,qBAAL,GAA6B,CAAC,UAAUzB,KAAV,EAAiB;EAAChF,IAAAA,OAAO,CAACa,GAAR,CAAYmE,KAAZ;EAAoB,GAAvC,CAA7B;EACAtF,EAAAA,IAAI,CAACqG,WAAL,GAAmB,EAAnB;EACArG,EAAAA,IAAI,CAACiG,MAAL,GAAc,EAAd;EACAjG,EAAAA,IAAI,CAACyE,KAAL,GAAa,EAAb;EACAzE,EAAAA,IAAI,CAACkF,MAAL,GAAc/B,MAAM,CAACC,MAAP,CAAc;EAClB+D,IAAAA,KAAK,EAAE,iBAAY;EACf,aAAO,IAAIpH,QAAJ,EAAP;EACH,KAHiB;EAI3BqH,IAAAA,IAAI,EAAE,cAAU/G,IAAV,EAAgBY,IAAhB,EAAsBqF,MAAtB,EAA8B;EACnC,aAAOW,QAAQ,CAAC5G,IAAD,EAAOY,IAAP,EAAaqF,MAAb,CAAf;EACA,KAN0B;EAO3Be,IAAAA,KAAK,EAAE,IAAItE,KAAJ,CAAUkE,QAAV,EAAoBxE,uBAAuB,EAA3C,CAPoB;EAQ3B6E,IAAAA,QAAQ,EAAE,kBAAUC,KAAV,EAAiBC,QAAjB,EAA2BC,OAA3B,EAAoC;EAC7CzH,MAAAA,IAAI,CAACqG,WAAL,CAAiBkB,KAAjB,IAA0BE,OAAO,IAAI,KAArC;EACAzH,MAAAA,IAAI,CAACiG,MAAL,CAAYsB,KAAZ,IAAqBC,QAArB;EACA,KAX0B;EAY3BE,IAAAA,WAAW,EAAE,qBAAUH,KAAV,EAAiB;EAC7B,aAAOvH,IAAI,CAACqG,WAAL,CAAiBkB,KAAjB,CAAP;EACA,aAAO,OAAOvH,IAAI,CAACiG,MAAL,CAAYsB,KAAZ,CAAd;EACA,KAf0B;EAgB3BI,IAAAA,gBAAgB,EAAE,0BAAUrC,KAAV,EAAiBjF,IAAjB,EAAuB;EACxC,UAAImD,OAAO,GAAGxD,IAAI,CAACwD,OAAL,EAAd;EACAxD,MAAAA,IAAI,CAAC0D,UAAL,CAAgB4B,KAAhB,EAAuB9B,OAAvB,IAAkCnD,IAAlC;EACA,aAAOmD,OAAP;EACA,KApB0B;EAqB3BoE,IAAAA,mBAAmB,EAAE,6BAAUtC,KAAV,EAAiBuC,KAAjB,EAAwB;EAC5C,UAAI7H,IAAI,CAAC0D,UAAL,CAAgB4B,KAAhB,EAAuBX,cAAvB,CAAsCkD,KAAtC,CAAJ,EAAkD;EACjD,eAAO7H,IAAI,CAAC0D,UAAL,CAAgB4B,KAAhB,EAAuBuC,KAAvB,CAAP;EACA,eAAO,IAAP;EACA,OAHD,MAGO;EACN,eAAO,KAAP;EACA;EACD,KA5B0B;EA6B3BC,IAAAA,OAAO,EAAE,iBAAUxC,KAAV,EAAiB;EACzB,UAAIhB,QAAQ,GAAG,IAAIvE,QAAJ,EAAf;EACAC,MAAAA,IAAI,CAACgE,iBAAL,CAAuBsB,KAAvB,EAA8B4B,IAA9B,CAAmC5C,QAAnC;EACA,aAAOA,QAAQ,CAAC3D,OAAhB;EACA,KAjC0B;EAkC3BoH,IAAAA,OAAO,EAAE,mBAAY;EACpB,aAAO/H,IAAI,CAAC+E,MAAL,CAAYiD,KAAZ,EAAP;EACA,KApC0B;EAqC3B7C,IAAAA,KAAK,EAAE,iBAAY;EAClB,aAAOjC,UAAU,CAAC,KAAK+E,SAAL,EAAD,CAAjB;EACA,KAvC0B;EAwC3BA,IAAAA,SAAS,EAAE,qBAAY;EACtB,UAAIjI,IAAI,CAACyD,aAAL,IAAsBzD,IAAI,CAAC+E,MAA/B,EACC,OAAO/E,IAAI,CAAC+E,MAAL,CAAY7B,UAAnB;EACD,aAAO,CAAP;EACA,KA5C0B;EA6C3BgF,IAAAA,OAAO,EAAE,mBAAY;EACpBlI,MAAAA,IAAI,CAACyD,aAAL,GAAqB,IAArB;EACAzD,MAAAA,IAAI,CAAC+E,MAAL,GAAcb,YAAY,EAA1B;EACA,KAhD0B;EAiD3BiE,IAAAA,sBAAsB,EAAE,gCAAUC,QAAV,EAAoB;EAC3C,aAAOpI,IAAI,CAAC+G,qBAAL,CAA2BG,IAA3B,CAAgCkB,QAAhC,IAA4C,CAAnD;EACA,KAnD0B;EAoD3BC,IAAAA,yBAAyB,EAAE,mCAAUR,KAAV,EAAiB;EACxC,aAAO7H,IAAI,CAAC+G,qBAAL,CAA2BuB,MAA3B,CAAkCT,KAAlC,EAAyC,CAAzC,EAA4C1F,MAAnD;EACH,KAtD0B;EAuDlBoG,IAAAA,OAAO,EAAE,iBAAU3G,IAAV,EAAgB;EACrB,aAAO5B,IAAI,CAAC+E,MAAL,CAAYe,IAAZ,CAAiBlE,IAAjB,CAAP;EACH;EAzDiB,GAAd,CAAd;EA4DA5B,EAAAA,IAAI,CAACkF,MAAL,CAAYoC,QAAZ,CAAqB,KAArB,EAA4B,UAAUkB,OAAV,EAAmB;EAC9ClI,IAAAA,OAAO,CAACmI,IAAR,2BAAgCD,OAAhC;EACA,GAFD;EAIAxI,EAAAA,IAAI,CAACkF,MAAL,CAAYoC,QAAZ,CAAqB,MAArB,EAA6B,UAAU1F,IAAV,EAAgB;EAC5C,WAAOA,IAAP;EACA,GAFD;EAIA,SAAO5B,IAAI,CAACkF,MAAZ;EACA;;EAGF9D,KAAK,CAACC,KAAN,GAAc,KAAd;EACAD,KAAK,CAACI,KAAN,GAAc,KAAd;;;;;;;;"}